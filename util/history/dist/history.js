define("mix/core/util/history/0.2.0/history",["mix/core/base/reset/1.0.0/reset","mix/core/base/class/1.0.0/class","mix/core/base/message/1.0.0/message"],function(e,t,n){e("mix/core/base/reset/1.0.0/reset");var r=e("mix/core/base/class/1.0.0/class"),i=e("mix/core/base/message/1.0.0/message"),s=/^[#\/]/,o=window,u=o.document,a=o.location,f=o.history,l=r.create({Implements:i,initialize:function(){var e=this;i.prototype.initialize.call(e,"history"),e._handlers=[],e._matchs=[],e._changeHanlder=Function.binded(e._changeHanlder,e)},_getHash:function(){return a.hash.slice(1)||""},_updateHash:function(e,t){t?a.replace(a.toString().replace(/(javascript:|#).*$/,"")+"#"+e):a.hash=e},_getFragment:function(e,t){var n=this;if(e==null)if(n._hasPushState||t){e=a.pathname;var r=a.search;r&&(e+=r)}else e=n._getHash();return e.indexOf(n._options.root)||(e=e.substr(n._options.root.length)),e.replace(s,"")},_cacheMatchs:function(){},_resetMatchs:function(){var e=this,t=e._handlers;t.forEach(function(e){e.matched=!1})},_changeHanlder:function(e){var t=this;t._resetMatchs(),t.match()},start:function(e){var t=this,n;if(l.started)throw new Error("history has already been started");l.started=!0,t._options=Object.extend({},{root:"/"},e||{}),t._wantsHashChange=t._options.hashChange!==!1,t._wantsPushState=!!t._options.pushState,t._hasPushState=!!(t._options.pushState&&f&&f.pushState),t._hasPushState?o.addEventListener("popstate",t._changeHanlder,!1):t._wantsHashChange&&"onhashchange"in o&&o.addEventListener("hashchange",t._changeHanlder,!1);var r=a.pathname==t._options.root;if(t._wantsHashChange&&t._wantsPushState&&!t._hasPushState&&!r)return n=t._getFragment(null,!0),a.replace(t._options.root+"#"+t._fragment),!0;t._wantsPushState&&t._hasPushState&&r&&a.hash&&(n=t._getFragment(),f.replaceState({},u.title,a.protocol+"//"+a.host+t._options.root+t._fragment));if(!t._options.silent)return t.match(n)},stop:function(){var e=this;if(!l.started)return;o.removeEventListener("popstate",e._changeHanlder,!1),o.removeEventListener("hashchange",e._changeHanlder,!1),l.started=!1},match:function(e){var t=this,e,n=t._handlers;if(!l.started)return;t._fragment=e=e||t._getFragment(),n.forEach(function(t){!t.matched&&t.route.test(e)&&(t.matched=!0,t.callback(e))})},route:function(e,t){var n=this,r=n._handlers;r.push({route:e,callback:t,matched:!1})},remove:function(e,t){var n=this,r=n._handlers;for(var i=0;i<r.length;i++){var s=r[i];if(s.route.source===e.source&&(!t||s.callback===t))return r.splice(i,1)}},navigate:function(e,t){var n=this,e;if(!l.started)return!1;if(!t||t===!0)t={trigger:t};e=(e||"").replace(s,"");if(n._fragment==e)return;n._hasPushState?(e.indexOf(n._options.root)!=0&&(e=n._options.root+e),f[t.replace?"replaceState":"pushState"]({},u.title,e)):n._wantsHashChange?n._updateHash(e,t.replace):a.assign(n._options.root+e),t.trigger&&n.match(e)}});l.started=!1,l.singleton=new l,n.exports=l});